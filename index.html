<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shadows of Kowloon â€“ Haunted Streets & Forgotten Souls</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0b" />
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='192' height='192'><rect width='100%' height='100%' fill='%230b0b0b'/><text x='50%' y='55%' font-size='110' text-anchor='middle' fill='%23c00000'>ğŸ‘»</text></svg>"> 
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
    :root { --bg:#0b0b0b; --panel:#141414; --brand:#c00000; --text:#eaeaea; --muted:#aaaaaa; }
    html, body { height:100%; margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji, Noto Color Emoji; }
    #app { display:grid; grid-template-rows:auto 1fr auto; height:100%; }
    header { padding:12px 16px; background:var(--panel); border-bottom:1px solid #222; }
    header h1 { font-size:1.05rem; margin:0; font-weight:700; }
    header .sub { font-size:.85rem; color:var(--muted); margin-top:2px; }
    #map { width:100%; height: calc(100vh - 280px); }
    .panel { padding:12px 16px; background:var(--panel); border-top:1px solid #222; }
    .btn { background:var(--brand); color:#fff; border:none; padding:10px 14px; border-radius:8px; font-size:.95rem; }
    .btn.alt { background:#2a2a2a; color:#eaeaea; border:1px solid #333; }
    .grid { display:grid; gap:8px; grid-template-columns:1fr 1fr; margin-bottom:10px; }
    details { background:#0f0f0f; border:1px solid #222; border-radius:8px; padding:8px 10px; }
    summary { cursor:pointer; font-weight:600; }
    a { color:#9ad0ff; text-decoration:none; }
    footer { padding:10px 16px; font-size:.8rem; color:var(--muted); background:var(--panel); }
    .legend { font-size:.8rem; color:var(--muted); margin-top:6px; }
  </style>
</head>
<body>
<div id="app">
  <header>
    <h1>Shadows of Kowloon â€“ Haunted Streets &amp; Forgotten Souls</h1>
    <div class="sub">é¬¼æ•…äº‹ (Ghost Story) Â· å°å¿ƒ (Beware)</div>
  </header>

  <div id="map" role="application" aria-label="Kowloon Ghost Tour Map"></div>

  <div class="panel">
    <div class="grid">
      <button id="locateBtn" class="btn" aria-label="Center on my location">ğŸ“ Locate Me</button>
      <a id="gmapsLink" class="btn alt" target="_blank" rel="noopener" href="https://www.google.com/maps/dir/Yau+Ma+Tei+Theatre,+Yau+Ma+Tei,+Hong+Kong/Tin+Hau+Temple,+Yau+Ma+Tei,+Hong+Kong/Shanghai+Street,+Yau+Ma+Tei,+Hong+Kong/Temple+Street+Night+Market,+Hong+Kong/St+Andrew%E2%80%99s+Church,+138+Nathan+Rd,+Tsim+Sha+Tsui,+Hong+Kong/">ğŸ—ºï¸ Open in Google Maps</a>
    </div>
    <div class="grid">
      <button id="toggleExtension" class="btn alt" aria-label="Toggle Kowloon Walled City extension">ğŸ¯ Toggle Walled City Extension</button>
      <a id="gmapsWc" class="btn alt" target="_blank" rel="noopener" href="https://www.google.com/maps/dir/Temple+Street+Night+Market,+Hong+Kong/Kowloon+Walled+City+Park,+Tung+Tau+Tsuen,+Hong+Kong/">ğŸƒâ€â™€ï¸ Extension in Google Maps</a>
    </div>
    <div class="grid">
      <button id="toggleFood" class="btn alt" aria-label="Toggle Man Fat Seafood Restaurant">ğŸ² Toggle Man Fat Seafood</button>
      <a class="btn alt" target="_blank" rel="noopener" href="https://www.openrice.com/en/hongkong/r-man-fat-seafood-restaurant-sham-shui-po-guangdong-seafood-r495907">ğŸ”— OpenRice page</a>
    </div>

    <details open>
      <summary>Story Guide (tap to expand/collapse)</summary>
      <div>
        <p><strong>1) Yau Ma Tei Theatre Â· 15 mins</strong><br>
        â€œThe flicker of old reels never truly fades. They say a projectionist once stayed late, only to hear applause from an empty hall. Some swear the balcony seats are never vacantâ€”ghostly patrons linger, waiting for the next show.â€</p>

        <p><strong>2) Tin Hau Temple (Yau Ma Tei) Â· 20 mins</strong><br>
        â€œIncense curls like spirits rising. Fishermen prayed here for safe voyages, but whispers claim those lost at sea return to seek blessings. After dark, fortune tellers sense unseen presencesâ€”perhaps souls still pleading for calm waters.â€ ï¼ˆå¤©åå»Ÿï¼šåœ¨é¦™ç…™è£Šè£Šä¸­ï¼Œéˆæ°£ç›¤æ—‹ã€‚ï¼‰</p>

        <p><strong>3) Shanghai Street Â· 20 mins</strong><br>
        â€œLook up at the tong lau balconies. During the Japanese occupation, screams echoed through these alleys. Today, residents report footsteps pacing aboveâ€”though the rooms have long been abandoned.â€ ï¼ˆå°å¿ƒï¼šæ¨“ä¸Šè…³æ­¥è²ï¼Œç„¡äººå¯è¦‹ã€‚ï¼‰</p>

        <p><strong>4) Temple Street Night Market Â· 30 mins</strong><br>
        â€œUnder neon glow, the market hums with life. Yet vendors tell of customers who vanish before paying, leaving only a chill. Fortune tellers whisper warningsâ€”sometimes the spirits come to bargain too.â€ ï¼ˆå»Ÿè¡—ï¼šå•åœæœ‰éˆï¼Œé™°é¢¨é™£é™£ã€‚ï¼‰</p>

        <p><strong>5) St Andrewâ€™s Church (Jordan) Â· 15â€“20 mins</strong><br>
        â€œRed brick and stained glass evoke quiet echoes of the past. Some visitors feel a sudden hushâ€”like unseen parishioners gathering for a midnight mass.â€ ï¼ˆè–å®‰å¾·çƒˆå ‚ï¼šå¯‚éœä¹‹ä¸­ï¼Œä¼¼æœ‰ä½èªç¦±å‘Šã€‚ï¼‰</p>

        <p><em>Extension:</em> <strong>Kowloon Walled City Park (Kowloon City)</strong> â€” better by taxi/bus from Temple Street (10â€“20 mins). â€œThe labyrinth is gone, but its ghosts wander stillâ€”seeking alleys that no longer exist.â€ ï¼ˆä¹é¾åŸå¯¨å…¬åœ’ï¼šåŸå¯¨å·²é€ï¼Œé™°é­‚æœªæ•£ã€‚ï¼‰</p>

        <p><em>Food Stop (Optional):</em> <strong>Man Fat Seafood Restaurant</strong> â€” G/F, 55 Fuk Wa Street, Sham Shui Po. Perfect for a late-night feast after haunting tales. ï¼ˆè¬ç™¼æµ·é®®èœé¤¨ï¼šæ·±æ°´åŸ—ç¦è¯è¡—55è™Ÿï¼‰</p>
      </div>
      <div class="legend">Legend: <span style="color:#c00000">â– </span> Main route Â· <span style="color:#8a2be2">â– </span> Walled City extension Â· <span style="color:#2e8b57">â– </span> Food stop</div>
    </details>
  </div>

  <footer>
    Install: Android (Chrome) â†’ â‹® â†’ Add to Home screen Â· iPhone (Safari) â†’ Share â†’ Add to Home Screen
  </footer>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
  // Initialize map
  const map = L.map('map', { zoomControl: true }).setView([22.3110, 114.1710], 15.8);

  // Base tiles
  const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap' 
  }).addTo(map);

  // Icons
  const ghostIcon = L.divIcon({ html: 'ğŸ‘»', className: 'ghost-marker', iconSize: [24,24] });
  const templeIcon = L.divIcon({ html: 'ğŸ¯', className: 'temple-marker', iconSize: [24,24] });
  const foodIcon = L.divIcon({ html: 'ğŸ²', className: 'food-marker', iconSize: [24,24] });

  // Main route stops (walkable cluster)
  const stops = [
    { name: 'Yau Ma Tei Theatre', coords: [22.3116, 114.1703], html: '<strong>Yau Ma Tei Theatre</strong><br/>â€œThe flicker of old reels never truly fadesâ€¦â€<br/><small>é¬¼æ•…äº‹ Â· å°å¿ƒ</small>' },
    { name: 'Tin Hau Temple (Yau Ma Tei)', coords: [22.3110, 114.1709], html: '<strong>Tin Hau Temple</strong><br/>â€œIncense curls like spirits risingâ€¦â€' },
    { name: 'Shanghai Street (Tong Lau segment)', coords: [22.3101, 114.1715], html: '<strong>Shanghai Street</strong><br/>â€œLook up at the tong lau balconiesâ€¦â€' },
    { name: 'Temple Street Night Market', coords: [22.3108, 114.1700], html: '<strong>Temple Street Night Market</strong><br/>â€œUnder neon glow, the market hums with lifeâ€¦â€' },
    { name: 'St Andrew's Church (Jordan)', coords: [22.3049, 114.1719], html: '<strong>St Andrew's Church (Jordan)</strong><br/>â€œRed brick and stained glass evoke quiet echoesâ€¦â€' }
  ];

  const mainMarkers = [];
  stops.forEach((s, idx) => {
    const m = L.marker(s.coords, { icon: ghostIcon }).addTo(map)
      .bindPopup(`<div style="min-width:200px"><div><strong>${idx+1}. ${s.name}</strong></div><div>${s.html}</div></div>`);
    mainMarkers.push(m);
  });
  const mainRoute = L.polyline(stops.map(s => s.coords), { color:'#c00000', weight:3 }).addTo(map);

  // Walled City extension markers
  const wcStops = [
    { name: 'Kowloon Walled City Park â€“ South Gate', coords: [22.3336, 114.1917], html: '<strong>Walled City Park â€“ South Gate</strong><br/>â€œEntrance to a vanished maze. åŸå¯¨å·²é€ï¼Œé™°é­‚æœªæ•£ã€‚â€' },
    { name: 'Kowloon Walled City Park â€“ Yamen (è¡™é–€)', coords: [22.33393, 114.19228], html: '<strong>Yamen (Former Qing Administration)</strong><br/>â€œEchoes of authority amid whispers of the past.â€' }
  ];
  const wcMarkers = wcStops.map(s => L.marker(s.coords, { icon: templeIcon }).bindPopup(`<div style="min-width:200px"><div><strong>${s.name}</strong></div><div>${s.html}</div></div>`));
  const wcRoute = L.polyline(wcStops.map(s => s.coords), { color:'#8a2be2', weight:3 });

  let wcVisible = false;
  document.getElementById('toggleExtension').addEventListener('click', () => {
    wcVisible = !wcVisible;
    if (wcVisible) {
      wcMarkers.forEach(m => m.addTo(map));
      wcRoute.addTo(map);
      const group = new L.featureGroup([...wcMarkers, wcRoute]);
      map.fitBounds(group.getBounds().pad(0.2));
    } else {
      wcMarkers.forEach(m => map.removeLayer(m));
      map.removeLayer(wcRoute);
      const group = new L.featureGroup([...mainMarkers, mainRoute]);
      map.fitBounds(group.getBounds().pad(0.2));
    }
  });

  // Man Fat Seafood Restaurant marker (food stop)
  const manFatCoords = [22.32595, 114.17083];
  const manFat = L.marker(manFatCoords, { icon: foodIcon }).bindPopup(`<div style="min-width:220px"><div><strong>Man Fat Seafood Restaurant</strong></div><div>ğŸ“ G/F, 55 Fuk Wa Street, Sham Shui Po<br/><a href="https://www.openrice.com/en/hongkong/r-man-fat-seafood-restaurant-sham-shui-po-guangdong-seafood-r495907" target="_blank" rel="noopener">OpenRice page</a></div><div>â€œClassic Cantonese seafoodâ€”perfect for ending the haunted walk.â€</div></div>`);
  let foodVisible = false;
  document.getElementById('toggleFood').addEventListener('click', () => {
    foodVisible = !foodVisible;
    if (foodVisible) {
      manFat.addTo(map);
      map.setView(manFatCoords, 17);
    } else {
      map.removeLayer(manFat);
      const group = new L.featureGroup([...mainMarkers, mainRoute]);
      map.fitBounds(group.getBounds().pad(0.2));
    }
  });

  // Locate-me button
  document.getElementById('locateBtn').addEventListener('click', () => {
    if (!navigator.geolocation) { alert('Geolocation not supported'); return; }
    navigator.geolocation.getCurrentPosition(
      pos => {
        const latlng = [pos.coords.latitude, pos.coords.longitude];
        L.marker(latlng).addTo(map).bindPopup('You are here').openPopup();
        map.setView(latlng, 17);
      },
      err => alert('Unable to access location: ' + err.message),
      { enableHighAccuracy:true, maximumAge:60000, timeout:10000 }
    );
  });

  // Register service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js');
    });
  }

  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => { deferredPrompt = e; });
</script>
</body>
</html>
